$def with (clients, active, revoked)
$var title: Auth

<!--form method=post action=/sign-ins/personal>
<button>Generate Personal Access Token</button>
</form-->

$# <style>
$# article {
$#     display: grid;
$#     grid-template-columns: 15em auto; }
$# </style>

$def render_client(auth):
    $ client_id = auth["client_id"].partition("://")[2]
    <a href=/clients/$client_id>\
    $if auth["client_name"]:
        $auth["client_name"]\
    $else:
        $client_id\
    </a>

$def render_auth(auth):
    <p>\
    $:render_client(auth)
    <br><small>$auth["redirect_uri"]<br>
    $auth["initiated"]</small></p>
    $ r = auth["response"]
    $if r["scope"]:
        <p>\
        $for scope in r["scope"]:
            <code>$scope</code>\
            $if not loop.last:
                , \
        </p>
    $if "profile" in r:
        <p>$r["profile"]["name"]<br><small>$r["profile"]["url"]</small></p>

<article>
<nav>
<h2>Clients</h2>
<ul>
$for client in clients:
    <li>$:render_client(client)</li>
</ul>
</nav>
<section>
<h2>Tokens</h2>
<form method=post action=/tokens>
<input type=hidden name=grant_type value=personal_access>
<button>Generate Token</button>
</form>
<h3>Active</h3>
$for auth in active:
    <div>
    $:render_auth(auth)
    <form action=/revoke method=post>
    <button>Revoke Token</button>
    </form>
    </div>
<h3>Revoked</h3>
$for auth in revoked:
    $:render_auth(auth)
    $if "access_token" in auth:
        <p>$auth["access_token"]</p>
    <p><em><strong>revoked $auth["revoked"]</strong></em></p>
</section>
</article>
