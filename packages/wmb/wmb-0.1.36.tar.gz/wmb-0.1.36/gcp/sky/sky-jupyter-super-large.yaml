# jupyter.yaml

name: sl-jupyter

resources:
  cloud: gcp
  instance_type: n2d-highmem-96
  region: us-west1
  disk_size: 1000
file_mounts:
  /data:
    source: gs://ecker-rachel-analysis/
    mode: MOUNT
  /cemba:
    source: gs://ecker-hanqing-wmb-us-west1/
    mode: MOUNT
  /ref:
    source: gs://ecker-hanqing-reference/
    mode: MOUNT
  /home/hanliu:
    source: gs://ecker-hanqing-analysis/
    mode: MOUNT

setup: |
  if [ -f /opt/conda/bin/mamba ]
  then
    echo "Skip setup"
  else
    conda install mamba -y -n base -c conda-forge
    pip install --upgrade pip
    gsutil cp gs://ecker-hanqing-wmb-us-west1/wmb/sky/env.yaml ./
    mamba env update -f env.yaml
    rm env.yaml
    git clone https://github.com/lhqing/gliderport.git
    cd gliderport
    pip install .
    cd ..
  fi

run: |
  cd ~/sky_workdir
  nohup jupyter-lab --LabApp.token='' --no-browser --port 9999 > ~/jupyter.log 2>&1 &
