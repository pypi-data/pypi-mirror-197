

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Fitting in SATLAS2 &#8212; SATLAS2</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/sphinx-toolbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/fitting/index';</script>
    <link rel="icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Extracting dataframes" href="../dataframe/index.html" />
    <link rel="prev" title="Making a model" href="../createmodel/index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/satlas_light.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/satlas_dark.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    SATLAS2 â€“ Statistical Analysis Toolbox for Laser Spectroscopy, version 2
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../architecture/index.html">Architecture of SATLAS2</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Tutorial</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../createmodel/index.html">Making a model</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Fitting in SATLAS2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dataframe/index.html">Extracting dataframes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkoptions/index.html">Different <code class="docutils literal notranslate"><span class="pre">emcee</span></code> moves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmark/index.html">Benchmark of SATLAS2 speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interface/index.html">Using the SATLAS interface</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/summaries/core.html">API Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/summaries/models.html">API Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/summaries/interface.html">API Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/summaries/plotting.html">API Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/summaries/utilities.html">API Utilities</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/woutergins/satlas2" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/woutergins/satlas2/edit/master/tutorials/fitting/index.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/woutergins/satlas2/issues/new?title=Issue%20on%20page%20%2Ftutorials/fitting/index.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/tutorials/fitting/index.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Fitting in SATLAS2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-fitting">Gaussian fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-prior-to-parameters">Adding prior to parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-with-likelihood-data">Fitting with likelihood data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-poisson-likelihood">Using Poisson likelihood</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-emcee">Using <code class="docutils literal notranslate"><span class="pre">emcee</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="fitting-in-satlas2">
<h1>Fitting in SATLAS2<a class="headerlink" href="#fitting-in-satlas2" title="Permalink to this heading">#</a></h1>
<p>SATLAS2 offers the option to do both chisquare and maximum likelihood
fits, in some capacity. First, start with importing all required
libraries to perform this tutorial:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..\src&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">satlas2</span>
</pre></div>
</div>
<p>Define a modified root function to handle uncertainties of 0 counts in a
Poisson statistic</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">modifiedSqrt</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="n">output</span><span class="p">[</span><span class="nb">input</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
<section id="gaussian-fitting">
<h2>Gaussian fitting<a class="headerlink" href="#gaussian-fitting" title="Permalink to this heading">#</a></h2>
<p>The most used case will be for data that has some experimental
uncertainties. In this case, chisquare fitting is the norm. This assumes
a Gaussian uncertainty distribution. For this, a random dataset for an
exponential decay is generated.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amplitude</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">halflife</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">ExponentialDecay</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">halflife</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Exp&#39;</span><span class="p">)</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">halflife</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">noise</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">generateSpectrum</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">noise</span><span class="p">))</span>
<span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">halflife</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data with Gaussian noise&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial guess&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_5_0.png" src="../../_images/output_5_0.png" />
<p>In order to fit to this data, create a Source where the experimental
data is added.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ArtificialData&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This has generated a Source where both the x-values, y-values, and the
uncertainty in y is known. As normal in SATLAS2, add the model to the
Source and add the Source to a Fitter in order to start the fitting:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Fitter</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addSource</span><span class="p">(</span><span class="n">datasource</span><span class="p">)</span>
</pre></div>
</div>
<p>The normal fitting can be done using the fit() method without any
additional parameters.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 19</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120089</span> <span class="o">+/-</span> <span class="mf">0.33155088</span> <span class="p">(</span><span class="mf">6.31</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698749</span> <span class="o">+/-</span> <span class="mf">0.26850056</span> <span class="p">(</span><span class="mf">9.92</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Other fitting methods then <em>leastsq</em> can be used by using the <em>method</em>
keyword.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span> <span class="c1"># To compare performance to normal fitting</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;slsqp&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = SLSQP</span>
    <span class="c1"># function evals   = 21</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120090</span> <span class="o">+/-</span> <span class="mf">0.32314795</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698589</span> <span class="o">+/-</span> <span class="mf">0.25131419</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The LMFIT library exposes the following fitting algorithms for use:</p>
<blockquote>
<div><ul class="simple">
<li><p>â€˜leastsqâ€™: Levenberg-Marquardt (default)</p></li>
<li><p>â€˜least_squaresâ€™: Least-Squares minimization, using Trust Region Reflective method</p></li>
<li><p>â€˜differential_evolutionâ€™: differential evolution</p></li>
<li><p>â€˜bruteâ€™: brute force method</p></li>
<li><p>â€˜basinhoppingâ€™: basinhopping</p></li>
<li><p>â€˜ampgoâ€™: Adaptive Memory Programming for Global Optimization</p></li>
<li><p>â€˜nelderâ€™: Nelder-Mead</p></li>
<li><p>â€˜lbfgsbâ€™: L-BFGS-B</p></li>
<li><p>â€˜powellâ€™: Powell</p></li>
<li><p>â€˜cgâ€™: Conjugate-Gradient</p></li>
<li><p>â€˜newtonâ€™: Newton-CG</p></li>
<li><p>â€˜cobylaâ€™: Cobyla</p></li>
<li><p>â€˜bfgsâ€™: BFGS</p></li>
<li><p>â€˜tncâ€™: Truncated Newton</p></li>
<li><p>â€˜trust-ncgâ€™: Newton-CG trust-region</p></li>
<li><p>â€˜trust-exactâ€™: nearly exact trust-region</p></li>
<li><p>â€˜trust-krylovâ€™: Newton GLTR trust-region</p></li>
<li><p>â€˜trust-constrâ€™: trust-region for constrained optimization</p></li>
<li><p>â€˜doglegâ€™: Dog-leg trust-region</p></li>
<li><p>â€˜slsqpâ€™: Sequential Linear Squares Programming</p></li>
<li><p>â€˜emceeâ€™: Maximum likelihood via Monte-Carlo Markov Chain</p></li>
<li><p>â€˜shgoâ€™: Simplicial Homology Global Optimization</p></li>
<li><p>â€˜dual_annealingâ€™: Dual Annealing optimization</p></li>
</ul>
</div></blockquote>
<p>However, some of these methods require the Jacobian or explicit
boundaries for all parameters to be provided. Therefore, the following
algorithms are recommended as options for SATLAS2:</p>
<blockquote>
<div><ul class="simple">
<li><p>â€˜leastsqâ€™: Levenberg-Marquardt (default)</p></li>
<li><p>â€˜least_squaresâ€™: Least-Squares minimization, using Trust Region Reflective method</p></li>
<li><p>â€˜basinhoppingâ€™: basinhopping</p></li>
<li><p>â€˜ampgoâ€™: Adaptive Memory Programming for Global Optimization</p></li>
<li><p>â€˜nelderâ€™: Nelder-Mead</p></li>
<li><p>â€˜lbfgsbâ€™: L-BFGS-B</p></li>
<li><p>â€˜powellâ€™: Powell</p></li>
<li><p>â€˜cgâ€™: Conjugate-Gradient</p></li>
<li><p>â€˜cobylaâ€™: Cobyla</p></li>
<li><p>â€˜bfgsâ€™: BFGS</p></li>
<li><p>â€˜tncâ€™: Truncated Newton</p></li>
<li><p>â€˜trust-constrâ€™: trust-region for constrained optimization</p></li>
<li><p>â€˜slsqpâ€™: Sequential Linear Squares Programming</p></li>
<li><p>â€˜emceeâ€™: Maximum likelihood via Monte-Carlo Markov Chain</p></li>
</ul>
</div></blockquote>
<p>As an example, the
generated data is fitted with each of these algorithms, to show they
give functionally the same answer. However, keep in mind that the speed
and success of each algorithm depends on the data and model used, so not
all algorithms may be suitable! As a rule of thumb, the least squares
algorithms are among the most stable and widely applicable.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;leastsq&#39;</span><span class="p">,</span>
 <span class="s1">&#39;least_squares&#39;</span><span class="p">,</span>
 <span class="s1">&#39;basinhopping&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ampgo&#39;</span><span class="p">,</span>
 <span class="s1">&#39;nelder&#39;</span><span class="p">,</span>
 <span class="s1">&#39;lbfgsb&#39;</span><span class="p">,</span>
 <span class="s1">&#39;powell&#39;</span><span class="p">,</span>
 <span class="s1">&#39;cg&#39;</span><span class="p">,</span>
 <span class="s1">&#39;cobyla&#39;</span><span class="p">,</span>
 <span class="s1">&#39;bfgs&#39;</span><span class="p">,</span>
 <span class="s1">&#39;tnc&#39;</span><span class="p">,</span>
 <span class="s1">&#39;trust-constr&#39;</span><span class="p">,</span>
 <span class="s1">&#39;slsqp&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
    <span class="n">evals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">nfev</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 19</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120089</span> <span class="o">+/-</span> <span class="mf">0.33155088</span> <span class="p">(</span><span class="mf">6.31</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698749</span> <span class="o">+/-</span> <span class="mf">0.26850056</span> <span class="p">(</span><span class="mf">9.92</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = least_squares</span>
    <span class="c1"># function evals   = 7</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120089</span> <span class="o">+/-</span> <span class="mf">0.33154988</span> <span class="p">(</span><span class="mf">6.31</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698749</span> <span class="o">+/-</span> <span class="mf">0.26850333</span> <span class="p">(</span><span class="mf">9.92</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = basinhopping</span>
    <span class="c1"># function evals   = 2505</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120348</span> <span class="o">+/-</span> <span class="mf">0.32314799</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698420</span> <span class="o">+/-</span> <span class="mf">0.25131396</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = ampgo, with L-BFGS-B as local solver</span>
    <span class="c1"># function evals   = 4644</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120344</span> <span class="o">+/-</span> <span class="mf">0.32314799</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698421</span> <span class="o">+/-</span> <span class="mf">0.25131396</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = Nelder-Mead</span>
    <span class="c1"># function evals   = 58</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997483</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851028</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120285</span> <span class="o">+/-</span> <span class="mf">0.32314600</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70695228</span> <span class="o">+/-</span> <span class="mf">0.25130868</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = L-BFGS-B</span>
    <span class="c1"># function evals   = 24</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120344</span> <span class="o">+/-</span> <span class="mf">0.32314799</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698421</span> <span class="o">+/-</span> <span class="mf">0.25131396</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = Powell</span>
    <span class="c1"># function evals   = 70</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856882</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809379</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997382</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87850927</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25117728</span> <span class="o">+/-</span> <span class="mf">0.32313557</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70680473</span> <span class="o">+/-</span> <span class="mf">0.25128384</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = CG</span>
    <span class="c1"># function evals   = 33</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120348</span> <span class="o">+/-</span> <span class="mf">0.32314799</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698419</span> <span class="o">+/-</span> <span class="mf">0.25131396</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = COBYLA</span>
    <span class="c1"># function evals   = 34</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856876</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997469</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851014</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25115052</span> <span class="o">+/-</span> <span class="mf">0.32314226</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70693798</span> <span class="o">+/-</span> <span class="mf">0.25130535</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = BFGS</span>
    <span class="c1"># function evals   = 24</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120352</span> <span class="o">+/-</span> <span class="mf">0.32314799</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698416</span> <span class="o">+/-</span> <span class="mf">0.25131395</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = TNC</span>
    <span class="c1"># function evals   = 156</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997485</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25117819</span> <span class="o">+/-</span> <span class="mf">0.32314717</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70699341</span> <span class="o">+/-</span> <span class="mf">0.25131501</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = equality_constrained_sqp</span>
    <span class="c1"># function evals   = 69</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120345</span> <span class="o">+/-</span> <span class="mf">0.32314799</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698419</span> <span class="o">+/-</span> <span class="mf">0.25131396</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = SLSQP</span>
    <span class="c1"># function evals   = 21</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120090</span> <span class="o">+/-</span> <span class="mf">0.32314795</span> <span class="p">(</span><span class="mf">6.15</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698589</span> <span class="o">+/-</span> <span class="mf">0.25131419</span> <span class="p">(</span><span class="mf">9.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">evals</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">evals</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">xticklabels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticklabels</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Function evaluations&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_17_1.png" src="../../_images/output_17_1.png" />
<p>From experimenting with simulated and actual hyperfine laser
spectroscopic data, the <code class="docutils literal notranslate"><span class="pre">slsqp</span></code> algorithm was found to offer both a
relatively fast and stable platform.</p>
</section>
<section id="adding-prior-to-parameters">
<h2>Adding prior to parameters<a class="headerlink" href="#adding-prior-to-parameters" title="Permalink to this heading">#</a></h2>
<p>Suppose a literature value is known and has to be applied to a parameter
as an additional constraint. This can be viewed as a prior, or
alternatively as an additional data point to fit to. A Gaussian prior
can easily be added via the <code class="docutils literal notranslate"><span class="pre">setParamPrior</span></code> method of the Fitter
object.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span> <span class="c1"># Fit without prior</span>
<span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">setParamPrior</span><span class="p">(</span><span class="s1">&#39;ArtificialData&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp&#39;</span><span class="p">,</span> <span class="s1">&#39;halflife&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="c1"># Add prior to fit the halflife of model Exp in the source ArtificialData to 3+/-0.1</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
<span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">setParamPrior</span><span class="p">(</span><span class="s1">&#39;ArtificialData&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp&#39;</span><span class="p">,</span> <span class="s1">&#39;halflife&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="c1"># Change the prior 3+/-0.5</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
<span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">removeParamPrior</span><span class="p">(</span><span class="s1">&#39;ArtificialData&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp&#39;</span><span class="p">,</span> <span class="s1">&#39;halflife&#39;</span><span class="p">)</span> <span class="c1"># Remove the prior</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 19</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120089</span> <span class="o">+/-</span> <span class="mf">0.33155088</span> <span class="p">(</span><span class="mf">6.31</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698749</span> <span class="o">+/-</span> <span class="mf">0.26850056</span> <span class="p">(</span><span class="mf">9.92</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 10</span>
    <span class="c1"># data points      = 21</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">15.0536495</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.79229734</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.99094168</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.90189680</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.04903680</span> <span class="o">+/-</span> <span class="mf">0.25418730</span> <span class="p">(</span><span class="mf">5.03</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.97175885</span> <span class="o">+/-</span> <span class="mf">0.08528185</span> <span class="p">(</span><span class="mf">2.87</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 16</span>
    <span class="c1"># data points      = 21</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.4439027</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.76020540</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">3.85925151</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.77020663</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.19393631</span> <span class="o">+/-</span> <span class="mf">0.30407003</span> <span class="p">(</span><span class="mf">5.85</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.78050485</span> <span class="o">+/-</span> <span class="mf">0.23033480</span> <span class="p">(</span><span class="mf">8.28</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 19</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">14.1856875</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.78809375</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">2.86997486</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.87851031</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25120089</span> <span class="o">+/-</span> <span class="mf">0.33155088</span> <span class="p">(</span><span class="mf">6.31</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70698749</span> <span class="o">+/-</span> <span class="mf">0.26850056</span> <span class="p">(</span><span class="mf">9.92</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fitting-with-likelihood-data">
<h2>Fitting with likelihood data<a class="headerlink" href="#fitting-with-likelihood-data" title="Permalink to this heading">#</a></h2>
<p>The fitting can also proceed by maximizing the likelihood (or rather,
minimizing the negative loglikelihood) instead of minimizing the
chisquare. In order to do this, use the <em>llh=True</em> parameter in the
fitting routine.</p>
<p>Currently, there are two options for the likelihood, which can be set
with the <em>llh_method</em> keyword: <em>gaussian</em> (the default) and <em>poisson</em>.
When the likelihood fitting is used, the <em>leastsq</em> and <em>least_squares</em>
methods cannot be applied since the negative loglikelihood is no longer
a sum of squares, an assumption which is critical in these algorithms.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">llh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
<span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">setParamPrior</span><span class="p">(</span><span class="s1">&#39;ArtificialData&#39;</span><span class="p">,</span> <span class="s1">&#39;Exp&#39;</span><span class="p">,</span> <span class="s1">&#39;halflife&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="c1"># Prior of 3+/-0.1</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">llh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = SLSQP</span>
    <span class="c1"># function evals   = 20</span>
    <span class="c1"># data points      = 20</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">8.21548506</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.45641584</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">13.7942296</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">11.8027650</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.25117472</span> <span class="o">+/-</span> <span class="mf">0.51478516</span> <span class="p">(</span><span class="mf">9.80</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.70699167</span> <span class="o">+/-</span> <span class="mf">0.40035373</span> <span class="p">(</span><span class="mf">14.79</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = SLSQP</span>
    <span class="c1"># function evals   = 15</span>
    <span class="c1"># data points      = 21</span>
    <span class="c1"># variables        = 2</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">9.84186102</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.51799269</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">11.9154300</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.82638508</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">ArtificialData___Exp___amplitude</span><span class="p">:</span>  <span class="mf">5.04906321</span> <span class="o">+/-</span> <span class="mf">0.40525527</span> <span class="p">(</span><span class="mf">8.03</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ArtificialData___Exp___halflife</span><span class="p">:</span>   <span class="mf">2.97176292</span> <span class="o">+/-</span> <span class="mf">0.13544977</span> <span class="p">(</span><span class="mf">4.56</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the reduced chisquare is still reported. However, in this
mode, it <em>no longer</em> is a valid statistical measure to look at! This is
also the reason why the uncertainties are different. The estimation of
the uncertainties is done by numerically approximating the Hessian
matrix of the problem and inverting it, and this is also done in the
chisquare methods. The reason it now differs is twofold: - The matrix
describing the problem is different, hence some numerical approximations
can give slightlly different results. - Since the reduced chisquare is
no longer a valid statistical measure, it can no longer be used to scale
the uncertainties!</p>
</section>
<section id="using-poisson-likelihood">
<h2>Using Poisson likelihood<a class="headerlink" href="#using-poisson-likelihood" title="Permalink to this heading">#</a></h2>
<p>Up to here, the likelihood fitting was focused on Gaussian
uncertainties, but a Poisson statistic can also be used for the
likelihood calculation. This option will be illustrated on artificial
hyperfine data.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spin</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">J</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9600</span><span class="p">,</span> <span class="mi">175</span><span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">315</span><span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">FWHMG</span> <span class="o">=</span> <span class="mi">135</span>
<span class="n">FWHML</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">centroid</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">90</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">17500</span><span class="p">,</span> <span class="o">-</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">23000</span><span class="p">,</span> <span class="mi">40</span><span class="p">)])</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Fitter</span><span class="p">()</span>
<span class="n">hfs</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">HFS</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span>
                  <span class="n">J</span><span class="p">,</span>
                  <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span>
                  <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span>
                  <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                  <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                  <span class="n">df</span><span class="o">=</span><span class="n">centroid</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;HFS1&#39;</span><span class="p">,</span>
                  <span class="n">racah</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">fwhmg</span><span class="o">=</span><span class="n">FWHMG</span><span class="p">,</span>
                  <span class="n">fwhml</span><span class="o">=</span><span class="n">FWHML</span><span class="p">)</span>
<span class="n">bkgm</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">([</span><span class="n">bkg</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bkg1&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">generateSpectrum</span><span class="p">([</span><span class="n">hfs</span><span class="p">,</span> <span class="n">bkgm</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">)</span>

<span class="n">datasource</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">,</span>
                            <span class="n">yerr</span><span class="o">=</span><span class="n">modifiedSqrt</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scan1&#39;</span><span class="p">)</span>

<span class="n">datasource</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">hfs</span><span class="p">)</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">bkgm</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">addSource</span><span class="p">(</span><span class="n">datasource</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_hfs</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">sources</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">datasource</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">sources</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">ax1</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">ax2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">smooth_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">datasource</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">datasource</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                                <span class="mf">5.0</span><span class="p">)</span>
        <span class="n">smooth_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">datasource</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">right</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                 <span class="n">datasource</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">right</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">datasource</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">left</span><span class="p">],</span>
                 <span class="n">datasource</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">left</span><span class="p">],</span>
                 <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-mid&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_left</span><span class="p">,</span> <span class="n">datasource</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">smooth_left</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">datasource</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
                 <span class="n">datasource</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
                 <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps-mid&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_right</span><span class="p">,</span> <span class="n">datasource</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">smooth_right</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [MHz]&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [MHz]&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">label_outer</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">label_outer</span><span class="p">()</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">])</span>
<span class="n">plot_hfs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_25_1.png" src="../../_images/output_25_1.png" />
<p>Notice that here, the <em>yerr</em> supplied to the Source is not an array, but
instead a function. When this is the case, the uncertainty on y is
calculated by applying the function to the sum of the underlying models.
In this case, this would give rise to using Pearsonâ€™s chisquare, where
the uncertainty on the datapoint is given by sqrt(f(x)). A preliminary
fit can be done by using the normal chisquare fitting.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">plot_hfs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 61</span>
    <span class="c1"># data points      = 150</span>
    <span class="c1"># variables        = 9</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">145.269585</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">1.03028075</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="mf">13.1933897</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="mf">40.2891074</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">Scan1___HFS1___centroid</span><span class="p">:</span>  <span class="mf">479.080650</span> <span class="o">+/-</span> <span class="mf">3.21744678</span> <span class="p">(</span><span class="mf">0.67</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">480</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Al</span><span class="p">:</span>        <span class="mf">9602.87663</span> <span class="o">+/-</span> <span class="mf">2.38671593</span> <span class="p">(</span><span class="mf">0.02</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">9600</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Au</span><span class="p">:</span>        <span class="mf">176.326690</span> <span class="o">+/-</span> <span class="mf">1.06392599</span> <span class="p">(</span><span class="mf">0.60</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">175</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bu</span><span class="p">:</span>        <span class="mf">320.837280</span> <span class="o">+/-</span> <span class="mf">8.31153123</span> <span class="p">(</span><span class="mf">2.59</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">315</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cu</span><span class="p">:</span>        <span class="mf">0.28989447</span> <span class="o">+/-</span> <span class="mf">0.64808883</span> <span class="p">(</span><span class="mf">223.56</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHMG</span><span class="p">:</span>     <span class="mf">124.983331</span> <span class="o">+/-</span> <span class="mf">20.4156372</span> <span class="p">(</span><span class="mf">16.33</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">135</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHML</span><span class="p">:</span>     <span class="mf">115.427701</span> <span class="o">+/-</span> <span class="mf">16.2067792</span> <span class="p">(</span><span class="mf">14.04</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___scale</span><span class="p">:</span>     <span class="mf">93.1256964</span> <span class="o">+/-</span> <span class="mf">4.04213464</span> <span class="p">(</span><span class="mf">4.34</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to2</span><span class="p">:</span>   <span class="mf">0.4545455</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to3</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to4</span><span class="p">:</span>   <span class="mf">0.3409091</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to3</span><span class="p">:</span>   <span class="mf">0.1590909</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to4</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to5</span><span class="p">:</span>   <span class="mi">1</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___bkg1___p0</span><span class="p">:</span>        <span class="mf">1.32051846</span> <span class="o">+/-</span> <span class="mf">0.29450939</span> <span class="p">(</span><span class="mf">22.30</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_27_1.png" src="../../_images/output_27_1.png" />
<p>We can see the difference by comparing to a Source where the uncertainty
in y is given by the square root:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yerr</span> <span class="o">=</span> <span class="n">modifiedSqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Fitter</span><span class="p">()</span>
<span class="n">hfs2</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">HFS</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span>
                   <span class="n">J</span><span class="p">,</span>
                   <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span>
                   <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span>
                   <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span>
                   <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                   <span class="n">df</span><span class="o">=</span><span class="n">centroid</span><span class="p">,</span>
                   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;HFS1&#39;</span><span class="p">,</span>
                   <span class="n">racah</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">fwhmg</span><span class="o">=</span><span class="n">FWHMG</span><span class="p">,</span>
                   <span class="n">fwhml</span><span class="o">=</span><span class="n">FWHML</span><span class="p">)</span>
<span class="n">bkgm2</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">([</span><span class="n">bkg</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bkg1&#39;</span><span class="p">)</span>

<span class="n">datasource2</span> <span class="o">=</span> <span class="n">satlas2</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                             <span class="n">y</span><span class="p">,</span>
                             <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Scan1&#39;</span><span class="p">)</span>
<span class="n">datasource2</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">hfs2</span><span class="p">)</span>
<span class="n">datasource2</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">bkgm2</span><span class="p">)</span>
<span class="n">f2</span><span class="o">.</span><span class="n">addSource</span><span class="p">(</span><span class="n">datasource2</span><span class="p">)</span>
<span class="n">f2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">plot_hfs</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f2</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = leastsq</span>
    <span class="c1"># function evals   = 51</span>
    <span class="c1"># data points      = 150</span>
    <span class="c1"># variables        = 9</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">154.121394</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">1.09305953</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="mf">22.0657907</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="mf">49.1615083</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">Scan1___HFS1___centroid</span><span class="p">:</span>  <span class="mf">478.154622</span> <span class="o">+/-</span> <span class="mf">3.14574940</span> <span class="p">(</span><span class="mf">0.66</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">480</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Al</span><span class="p">:</span>        <span class="mf">9603.17923</span> <span class="o">+/-</span> <span class="mf">2.31958026</span> <span class="p">(</span><span class="mf">0.02</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">9600</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Au</span><span class="p">:</span>        <span class="mf">175.647786</span> <span class="o">+/-</span> <span class="mf">1.02797017</span> <span class="p">(</span><span class="mf">0.59</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">175</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bu</span><span class="p">:</span>        <span class="mf">324.809731</span> <span class="o">+/-</span> <span class="mf">8.15038145</span> <span class="p">(</span><span class="mf">2.51</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">315</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cu</span><span class="p">:</span>        <span class="mf">0.53845378</span> <span class="o">+/-</span> <span class="mf">0.60603957</span> <span class="p">(</span><span class="mf">112.55</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHMG</span><span class="p">:</span>     <span class="mf">155.650412</span> <span class="o">+/-</span> <span class="mf">15.1637090</span> <span class="p">(</span><span class="mf">9.74</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">135</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHML</span><span class="p">:</span>     <span class="mf">81.1159460</span> <span class="o">+/-</span> <span class="mf">13.7997436</span> <span class="p">(</span><span class="mf">17.01</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___scale</span><span class="p">:</span>     <span class="mf">91.2170258</span> <span class="o">+/-</span> <span class="mf">3.69217051</span> <span class="p">(</span><span class="mf">4.05</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to2</span><span class="p">:</span>   <span class="mf">0.4545455</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to3</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to4</span><span class="p">:</span>   <span class="mf">0.3409091</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to3</span><span class="p">:</span>   <span class="mf">0.1590909</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to4</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to5</span><span class="p">:</span>   <span class="mi">1</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___bkg1___p0</span><span class="p">:</span>        <span class="mf">0.54384301</span> <span class="o">+/-</span> <span class="mf">0.22795427</span> <span class="p">(</span><span class="mf">41.92</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_29_1.png" src="../../_images/output_29_1.png" />
<p>While not extremely large, there is a noticable difference between the
results. The Pearsonâ€™s chisquare is recommended since this is the better
approximation of the Poisson statistics.</p>
<p>However, the Poisson likellihood can also be used to fit the spectrum:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">llh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">llh_method</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
<span class="n">plot_hfs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = SLSQP</span>
    <span class="c1"># function evals   = 352</span>
    <span class="c1"># data points      = 150</span>
    <span class="c1"># variables        = 9</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">527353.038</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">3740.09247</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="mf">1242.74853</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="mf">1269.84425</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">Scan1___HFS1___centroid</span><span class="p">:</span>  <span class="mf">479.100586</span> <span class="o">+/-</span> <span class="mf">4.33513046</span> <span class="p">(</span><span class="mf">0.90</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">480</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Al</span><span class="p">:</span>        <span class="mf">9602.92888</span> <span class="o">+/-</span> <span class="mf">3.15529346</span> <span class="p">(</span><span class="mf">0.03</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">9600</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Au</span><span class="p">:</span>        <span class="mf">176.139805</span> <span class="o">+/-</span> <span class="mf">1.41592721</span> <span class="p">(</span><span class="mf">0.80</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">175</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bu</span><span class="p">:</span>        <span class="mf">322.344602</span> <span class="o">+/-</span> <span class="mf">11.1539978</span> <span class="p">(</span><span class="mf">3.46</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">315</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cu</span><span class="p">:</span>        <span class="mf">0.34831527</span> <span class="o">+/-</span> <span class="mf">0.85318133</span> <span class="p">(</span><span class="mf">244.95</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHMG</span><span class="p">:</span>     <span class="mf">126.466451</span> <span class="o">+/-</span> <span class="mf">24.1675668</span> <span class="p">(</span><span class="mf">19.11</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">135</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHML</span><span class="p">:</span>     <span class="mf">114.489689</span> <span class="o">+/-</span> <span class="mf">19.6138914</span> <span class="p">(</span><span class="mf">17.13</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___scale</span><span class="p">:</span>     <span class="mf">93.0371162</span> <span class="o">+/-</span> <span class="mf">5.32580850</span> <span class="p">(</span><span class="mf">5.72</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to2</span><span class="p">:</span>   <span class="mf">0.4545455</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to3</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to4</span><span class="p">:</span>   <span class="mf">0.3409091</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to3</span><span class="p">:</span>   <span class="mf">0.1590909</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to4</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to5</span><span class="p">:</span>   <span class="mi">1</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___bkg1___p0</span><span class="p">:</span>        <span class="mf">0.83471487</span> <span class="o">+/-</span> <span class="mf">0.33553551</span> <span class="p">(</span><span class="mf">40.20</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_31_1.png" src="../../_images/output_31_1.png" />
<p>Here, itâ€™s more than clear that the (reduced) chisquare is not usable,
since LMFIT internally <em>assumes</em> what is returned in the cost function
is the chisquare statistic.</p>
</section>
<section id="using-emcee">
<h2>Using <code class="docutils literal notranslate"><span class="pre">emcee</span></code><a class="headerlink" href="#using-emcee" title="Permalink to this heading">#</a></h2>
<p>One option that is given by LMFIT as an optimizer but not demonstrated
is the <code class="docutils literal notranslate"><span class="pre">emcee</span></code> option. Using this, the returned value is treated as a
loglikelihood for a random walk algorithm. By using many walkers to
sample the loglikelihood, a very good approximation of the probability
density function is generated. For more information, see the
documentation of the <code class="docutils literal notranslate"><span class="pre">emcee</span></code> package.</p>
<p>Here, the basic usage in SATLAS2 will be illustrated, along with some
advanced topic to modify the working of the underlying algorithm.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">llh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">llh_method</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;emcee&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nwalkers</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000 [00:10&lt;00:00, 91.95it/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The chain is shorter than 50 times the integrated autocorrelation time for 8 parameter(s). Use this estimate with caution and run a longer chain!
N/50 = 20;
tau: [56.03746971 50.19572236 48.76119684 54.62125998         nan 55.75800502
 57.46850239 48.427324   51.04319725]
[[Fit Statistics]]
    # fitting method   = emcee
    # function evals   = 50000
    # data points      = 1
    # variables        = 9
    chi-square         = 0.00000000
    reduced chi-square = 0.00000000
    Akaike info crit   = -8148.27696
    Bayesian info crit = -8166.27696
[[Variables]]
    Scan1___HFS1___centroid:  478.754968 +/- 3.36112524 (0.70%) (init = 480)
    Scan1___HFS1___Al:        9602.88489 +/- 2.47289183 (0.03%) (init = 9600)
    Scan1___HFS1___Au:        176.147526 +/- 1.09427588 (0.62%) (init = 175)
    Scan1___HFS1___Bl:        0 (fixed)
    Scan1___HFS1___Bu:        322.133034 +/- 8.61135651 (2.67%) (init = 315)
    Scan1___HFS1___Cl:        0 (fixed)
    Scan1___HFS1___Cu:        0.00000000 +/- 0.00000000 (nan%) (init = 0)
    Scan1___HFS1___FWHMG:     127.070329 +/- 18.2713574 (14.38%) (init = 135)
    Scan1___HFS1___FWHML:     114.104097 +/- 15.0276800 (13.17%) (init = 101)
    Scan1___HFS1___scale:     92.2315758 +/- 3.90345595 (4.23%) (init = 90)
    Scan1___HFS1___Amp3to2:   0.4545455 (fixed)
    Scan1___HFS1___Amp3to3:   0.4772727 (fixed)
    Scan1___HFS1___Amp3to4:   0.3409091 (fixed)
    Scan1___HFS1___Amp4to3:   0.1590909 (fixed)
    Scan1___HFS1___Amp4to4:   0.4772727 (fixed)
    Scan1___HFS1___Amp4to5:   1 (fixed)
    Scan1___bkg1___p0:        0.88489588 +/- 0.24745153 (27.96%) (init = 1)
</pre></div>
</div>
<p>The results of the fitting are calculated by taking the median of the
samples as the central value, and the average of the one-sided 1-sigma
as the general uncertainty on the parameter. However, fitting this way
loses some information, since there is no saved record of the sampled
parameters, and the validity of the walk cannot be tested. In
particular, note that Cu has a peculiar value which requires some
investigation.</p>
<p>In order to do this, the chain of samples can be saved by specifying a
filename:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;emceeDemonstration.h5&#39;</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">llh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">llh_method</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;emcee&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nwalkers</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000 [00:18&lt;00:00, 53.99it/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The chain is shorter than 50 times the integrated autocorrelation time for 8 parameter(s). Use this estimate with caution and run a longer chain!
N/50 = 20;
tau: [57.04341752 53.56998762 54.11377706 55.15716973         nan 53.95575965
 60.18713051 50.04226876 55.48363343]
[[Fit Statistics]]
    # fitting method   = emcee
    # function evals   = 50000
    # data points      = 1
    # variables        = 9
    chi-square         = 0.00000000
    reduced chi-square = 0.00000000
    Akaike info crit   = -8148.29278
    Bayesian info crit = -8166.29278
[[Variables]]
    Scan1___HFS1___centroid:  479.119418 +/- 3.23737942 (0.68%) (init = 480)
    Scan1___HFS1___Al:        9602.76065 +/- 2.51181010 (0.03%) (init = 9600)
    Scan1___HFS1___Au:        176.127101 +/- 1.10213818 (0.63%) (init = 175)
    Scan1___HFS1___Bl:        0 (fixed)
    Scan1___HFS1___Bu:        320.765821 +/- 8.85014810 (2.76%) (init = 315)
    Scan1___HFS1___Cl:        0 (fixed)
    Scan1___HFS1___Cu:        0.00000000 +/- 0.00000000 (nan%) (init = 0)
    Scan1___HFS1___FWHMG:     129.179634 +/- 18.3504559 (14.21%) (init = 135)
    Scan1___HFS1___FWHML:     112.856566 +/- 15.0718209 (13.35%) (init = 101)
    Scan1___HFS1___scale:     92.4039066 +/- 4.05517245 (4.39%) (init = 90)
    Scan1___HFS1___Amp3to2:   0.4545455 (fixed)
    Scan1___HFS1___Amp3to3:   0.4772727 (fixed)
    Scan1___HFS1___Amp3to4:   0.3409091 (fixed)
    Scan1___HFS1___Amp4to3:   0.1590909 (fixed)
    Scan1___HFS1___Amp4to4:   0.4772727 (fixed)
    Scan1___HFS1___Amp4to5:   1 (fixed)
    Scan1___bkg1___p0:        0.86826205 +/- 0.23783254 (27.39%) (init = 1)
</pre></div>
</div>
<p>The fit resulted in the same parametervalues, so the saved chain can be
used to analyse why Cu is causing issues. In order to do this, one of
the ways to visualise the result is by looking at the plot of the
walkers:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">satlas2</span><span class="o">.</span><span class="n">generateWalkPlot</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_38_1.png" src="../../_images/output_38_1.png" />
<p>As the walkers progress towards their 1000 steps, nearly all parameters
leave their phase of only exploring a tiny bit around the initial value
and properly spread out. This burn-in phase is generally regarded as an
undesired feature of the random walk algorithm and is normally
discarded. Based on this plot, a claim for a burn-in phase of about 200
steps can be made.</p>
<p>In order to see the results for Cu in more detail, the results can be
filtered:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">satlas2</span><span class="o">.</span><span class="n">generateWalkPlot</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Cu&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../../_images/output_40_1.png" src="../../_images/output_40_1.png" />
<p>As can be seen here, there is absolutely no variation in the Cu value.
One of the possibilities that spring to mind is that the boundaries put
on the parameter force it to be 0. If that were the case however, the
fitting with other routines would also have restricted the value to 0,
which it hasnâ€™t. Another assumption is that the value of <em>exactly</em> 0 can
be an issue for the random walker. This can be tested by reverting the
fit, slightly adjusting the value (either directly or by doing a
preliminary fit), and performing the random walk again.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">revertFit</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;emceeDemonstrationCu.h5&#39;</span>
<span class="n">f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">llh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">llh_method</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;emcee&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">nwalkers</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
<span class="n">satlas2</span><span class="o">.</span><span class="n">generateWalkPlot</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">,</span> <span class="s1">&#39;Au&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1000/1000 [00:18&lt;00:00, 53.63it/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The chain is shorter than 50 times the integrated autocorrelation time for 9 parameter(s). Use this estimate with caution and run a longer chain!
N/50 = 20;
tau: [49.79535749 56.83821005 52.78761371 54.3836919  49.65206895 47.99592459
 50.88289254 49.70732336 74.38901137]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">Fit</span> <span class="n">Statistics</span><span class="p">]]</span>
    <span class="c1"># fitting method   = emcee</span>
    <span class="c1"># function evals   = 50000</span>
    <span class="c1"># data points      = 1</span>
    <span class="c1"># variables        = 9</span>
    <span class="n">chi</span><span class="o">-</span><span class="n">square</span>         <span class="o">=</span> <span class="mf">0.00000000</span>
    <span class="n">reduced</span> <span class="n">chi</span><span class="o">-</span><span class="n">square</span> <span class="o">=</span> <span class="mf">0.00000000</span>
    <span class="n">Akaike</span> <span class="n">info</span> <span class="n">crit</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">8148.56089</span>
    <span class="n">Bayesian</span> <span class="n">info</span> <span class="n">crit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8166.56089</span>
<span class="p">[[</span><span class="n">Variables</span><span class="p">]]</span>
    <span class="n">Scan1___HFS1___centroid</span><span class="p">:</span>  <span class="mf">479.179130</span> <span class="o">+/-</span> <span class="mf">3.15197251</span> <span class="p">(</span><span class="mf">0.66</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">479.0807</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Al</span><span class="p">:</span>        <span class="mf">9603.03121</span> <span class="o">+/-</span> <span class="mf">2.31025284</span> <span class="p">(</span><span class="mf">0.02</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">9602.877</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Au</span><span class="p">:</span>        <span class="mf">176.165779</span> <span class="o">+/-</span> <span class="mf">1.01302344</span> <span class="p">(</span><span class="mf">0.58</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">176.3267</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Bu</span><span class="p">:</span>        <span class="mf">322.223737</span> <span class="o">+/-</span> <span class="mf">7.69174619</span> <span class="p">(</span><span class="mf">2.39</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">320.8373</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cl</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Cu</span><span class="p">:</span>        <span class="mf">0.29007848</span> <span class="o">+/-</span> <span class="mf">0.48222380</span> <span class="p">(</span><span class="mf">166.24</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">0.2898991</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHMG</span><span class="p">:</span>     <span class="mf">126.034020</span> <span class="o">+/-</span> <span class="mf">16.4263323</span> <span class="p">(</span><span class="mf">13.03</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">124.9833</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___FWHML</span><span class="p">:</span>     <span class="mf">114.134035</span> <span class="o">+/-</span> <span class="mf">13.4331215</span> <span class="p">(</span><span class="mf">11.77</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">115.4277</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___scale</span><span class="p">:</span>     <span class="mf">92.8760544</span> <span class="o">+/-</span> <span class="mf">3.69820672</span> <span class="p">(</span><span class="mf">3.98</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">93.1257</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to2</span><span class="p">:</span>   <span class="mf">0.4545455</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to3</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp3to4</span><span class="p">:</span>   <span class="mf">0.3409091</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to3</span><span class="p">:</span>   <span class="mf">0.1590909</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to4</span><span class="p">:</span>   <span class="mf">0.4772727</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___HFS1___Amp4to5</span><span class="p">:</span>   <span class="mi">1</span> <span class="p">(</span><span class="n">fixed</span><span class="p">)</span>
    <span class="n">Scan1___bkg1___p0</span><span class="p">:</span>        <span class="mf">0.90596271</span> <span class="o">+/-</span> <span class="mf">0.28898660</span> <span class="p">(</span><span class="mf">31.90</span><span class="o">%</span><span class="p">)</span> <span class="p">(</span><span class="n">init</span> <span class="o">=</span> <span class="mf">1.320519</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_42_4.png" src="../../_images/output_42_4.png" />
<p>This shows that indeed, the value of exactly 0 is an issue for the
random walker!</p>
<p>However, the small value of Cu in general lead to a much larger burn-in
time, now more along the lines of 300-400 steps. By utilizing a burn-in
time of 400 steps, more than enough samples are still present to
generate a corner plot, where the 1D and 2D distributions of the samples
is presented.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">satlas2</span><span class="o">.</span><span class="n">generateCorrelationPlot</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_44_1.png" src="../../_images/output_44_1.png" />
<p>For clarity, this plot can also be filtered to only the parameters that
are of interest. For further modification, the binning can be reduced
with keywords:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">satlas2</span><span class="o">.</span><span class="n">generateCorrelationPlot</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Al&#39;</span><span class="p">,</span> <span class="s1">&#39;Au&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">],</span> <span class="n">burnin</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">binreduction</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bin2dreduction</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_46_1.png" src="../../_images/output_46_1.png" />
<p>Now only the hyperfine parameters are shown. The number of bins in the
1D case has been reduced by a factor 2, and the number of bins in the 2D
case by a further factor of 2, for a total reduction of 4 compared to
the previous plot.</p>
<p>Overall, the results here are shown to be quite Gaussian, and can be
used in the normal way. One more adaptation that can be made is removing
the burn-in from the results. This can be done by processing the random
walk with the <em>readWalk</em> method of the Fitter.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">readWalk</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">reportFit</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The chain is shorter than 50 times the integrated autocorrelation time for 9 parameter(s). Use this estimate with caution and run a longer chain!
N/50 = 12;
tau: [45.62991851 40.32541678 37.45399196 39.03747261 40.87049522 37.94803522
 40.69432958 39.98245743 37.78922749]
[[Fit Statistics]]
    # fitting method   = emcee
    # function evals   = 30000
    # data points      = unknown
    # variables        = 9
    chi-square         = unknown
    reduced chi-square = unknown
    Akaike info crit   = unknown
    Bayesian info crit = unknown
[[Variables]]
    Scan1___HFS1___centroid:  479.423946 +/- 3.02033029 (0.63%) (init = 479.1791)
    Scan1___HFS1___Al:        9603.01272 +/- 2.17492439 (0.02%) (init = 9603.031)
    Scan1___HFS1___Au:        176.168601 +/- 0.97595651 (0.55%) (init = 176.1658)
    Scan1___HFS1___Bl:        0 (fixed)
    Scan1___HFS1___Bu:        322.518878 +/- 7.52505337 (2.33%) (init = 322.2237)
    Scan1___HFS1___Cl:        0 (fixed)
    Scan1___HFS1___Cu:        0.30503616 +/- 0.60819137 (199.38%) (init = 0.2900785)
    Scan1___HFS1___FWHMG:     126.223702 +/- 17.9552979 (14.22%) (init = 126.034)
    Scan1___HFS1___FWHML:     114.555690 +/- 14.8834032 (12.99%) (init = 114.134)
    Scan1___HFS1___scale:     92.8395450 +/- 3.89293442 (4.19%) (init = 92.87605)
    Scan1___HFS1___Amp3to2:   0.4545455 (fixed)
    Scan1___HFS1___Amp3to3:   0.4772727 (fixed)
    Scan1___HFS1___Amp3to4:   0.3409091 (fixed)
    Scan1___HFS1___Amp4to3:   0.1590909 (fixed)
    Scan1___HFS1___Amp4to4:   0.4772727 (fixed)
    Scan1___HFS1___Amp4to5:   1 (fixed)
    Scan1___bkg1___p0:        0.83493074 +/- 0.24998430 (29.94%) (init = 0.9059627)
</pre></div>
</div>
<p>The burnin has been processed correctly, as the value of e.g. Cu has
been modified from 0.29+/-0.48 to 0.3+/-0.6, which is what the processed
plot shows it should be.</p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../createmodel/index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Making a model</p>
      </div>
    </a>
    <a class="right-next"
       href="../dataframe/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extracting dataframes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-fitting">Gaussian fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-prior-to-parameters">Adding prior to parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-with-likelihood-data">Fitting with likelihood data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-poisson-likelihood">Using Poisson likelihood</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-emcee">Using <code class="docutils literal notranslate"><span class="pre">emcee</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Wouter Gins
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2023, Wouter Gins.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>