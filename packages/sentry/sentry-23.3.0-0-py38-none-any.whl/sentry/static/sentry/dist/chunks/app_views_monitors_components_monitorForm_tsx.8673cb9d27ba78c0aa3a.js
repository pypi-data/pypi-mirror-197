"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_monitors_components_monitorForm_tsx"],{"./app/views/monitors/components/monitorForm.tsx":(e,t,n)=>{n.d(t,{Z:()=>O});var i=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),r=n("../node_modules/mobx-react-lite/es/index.js"),l=n("./app/components/alert.tsx"),a=n("./app/components/forms/fieldGroup/index.tsx"),c=n("./app/components/forms/fields/numberField.tsx"),d=n("./app/components/forms/fields/radioField.tsx"),p=n("./app/components/forms/fields/selectField.tsx"),u=n("./app/components/forms/fields/sentryProjectSelectorField.tsx"),m=n("./app/components/forms/fields/textField.tsx"),h=n("./app/components/forms/form.tsx"),f=n("./app/components/forms/model.tsx"),g=n("./app/components/links/externalLink.tsx"),Z=n("./app/components/list/index.tsx"),x=n("./app/components/list/listItem.tsx"),y=n("./app/components/text.tsx"),b=n("./app/components/textCopyInput.tsx"),k=n("./app/components/timeSince.tsx"),w=n("./app/data/timezones.tsx"),v=n("./app/locale.tsx"),_=n("./app/styles/space.tsx"),j=n("./app/utils/theme.tsx"),C=n("./app/utils/usePageFilters.tsx"),S=n("./app/utils/useProjects.tsx"),I=n("./app/views/monitors/utils.tsx"),N=n("./app/views/monitors/types.tsx"),R=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const A=[[N.Ix.INTERVAL,(0,v.t)("Interval")],[N.Ix.CRONTAB,(0,v.t)("Crontab")]],E="cron_job";function q(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,i]=t;return n.startsWith("config.")?(e.config??={},"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[1,"hour"]),Array.isArray(e.config.schedule)&&"config.schedule.frequency"===n?(e.config.schedule[0]=parseInt(i,10),e):Array.isArray(e.config.schedule)&&"config.schedule.interval"===n?(e.config.schedule[1]=i,e):(e.config[n.substr(7)]=i,e)):(e[n]=i,e)}),{})}function B(e){let{monitor:t,submitLabel:n,apiEndpoint:o,apiMethod:a,onSubmitSuccess:c}=e;const p=(0,s.useRef)(new f.Z({transformData:q})),{projects:u}=(0,S.Z)(),{selection:m}=(0,C.Z)(),[Z,x]=(0,s.useState)(t?.config.schedule_type===N.Ix.CRONTAB?t?.config.schedule:null),y=m.projects[0],b=y?u.find((e=>e.id===y+"")):null,_=(0,I.Z)(Z);return(0,R.tZ)(h.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:o,apiMethod:a,model:p.current,initialData:t?{name:t.name,type:t.type??E,project:t.project.slug,...function(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):(n["config.schedule"]=t.schedule,n["config.timezone"]=t.timezone)),n}(t.type,t.config)}:{project:b?b.slug:null,type:E},onSubmitSuccess:c,submitLabel:n,children:(0,R.BX)(T,{symbol:"colored-numeric",children:[(0,R.tZ)(D,{children:(0,v.t)("Add a name and project")}),(0,R.tZ)(H,{children:(0,v.t)("The monitor name will show up in alerts and notifications")}),(0,R.BX)(K,{children:[(0,R.tZ)(L,{name:"name",placeholder:(0,v.t)("My Cron Job"),required:!0,stacked:!0,inline:!1}),(0,R.tZ)(V,{name:"project",projects:u.filter((e=>e.isMember)),disabled:!!t,disabledReason:(0,v.t)("Existing monitors cannot be moved between projects"),valueIsSlug:!0,required:!0,stacked:!0,inline:!1}),t&&(0,R.tZ)(X,{flexibleControlStateSize:!0,stacked:!0,inline:!1,children:(0,R.tZ)(F,{children:t.slug})})]}),(0,R.tZ)(D,{children:(0,v.t)("Choose your schedule type")}),(0,R.tZ)(H,{children:(0,v._N)("You can use our simple schedule or [link:the crontab syntax].",{link:(0,R.tZ)(g.Z,{href:"https://en.wikipedia.org/wiki/Cron"})})}),(0,R.tZ)(K,{children:(0,R.tZ)(d.Z,{name:"config.schedule_type",choices:A,defaultValue:N.Ix.CRONTAB,orientInline:!0,required:!0,stacked:!0,inline:!1})}),(0,R.tZ)(D,{children:(0,v.t)("Choose your schedule")}),(0,R.tZ)(H,{children:(0,v.t)("How often you expect your recurring jobs to run.")}),(0,R.BX)(K,{children:[void 0!==t&&t.nextCheckIn&&(0,R.tZ)(l.ZP,{type:"info",children:(0,v._N)("Any changes you make to the execution schedule will only be applied after the next expected check-in [nextCheckin].",{nextCheckin:(0,R.tZ)("strong",{children:(0,R.tZ)(k.Z,{date:t.nextCheckIn})})})}),(0,R.tZ)(r.Qj,{children:()=>{const e=p.current.getValue("config.schedule_type");return"crontab"===e?(0,R.BX)(U,{children:[(0,R.tZ)(L,{name:"config.schedule",placeholder:"*/5 * * * *",css:(0,i.iv)({input:{fontFamily:j.ZP.text.familyMono}},"",""),required:!0,stacked:!0,onChange:x,inline:!1}),(0,R.tZ)(z,{name:"config.timezone",defaultValue:"UTC",options:w.f,required:!0,stacked:!0,inline:!1}),_&&(0,R.BX)(G,{children:['"',_,'"']})]}):"interval"===e?(0,R.BX)(U,{interval:!0,children:[(0,R.tZ)(P,{children:(0,v.t)("Every")}),(0,R.tZ)(M,{name:"config.schedule.frequency",placeholder:"e.g. 1",required:!0,stacked:!0,inline:!1}),(0,R.tZ)(z,{name:"config.schedule.interval",options:(t=Number(p.current.getValue("config.schedule.frequency")??1),[{value:"minute",label:(0,v.tn)("minute","minutes",t)},{value:"hour",label:(0,v.tn)("hour","hours",t)},{value:"day",label:(0,v.tn)("day","days",t)},{value:"week",label:(0,v.tn)("week","weeks",t)},{value:"month",label:(0,v.tn)("month","months",t)},{value:"year",label:(0,v.tn)("year","years",t)}]),required:!0,stacked:!0,inline:!1})]}):null;var t}})]}),(0,R.tZ)(D,{children:(0,v.t)("Set a missed status")}),(0,R.tZ)(H,{children:(0,v.t)("How long to wait before we consider a check-in as missed.")}),(0,R.tZ)(K,{children:(0,R.BX)(J,{children:[(0,R.tZ)(M,{name:"config.checkin_margin",placeholder:"e.g. 30",stacked:!0,inline:!1}),(0,R.tZ)(P,{children:(0,v.t)("Minutes")})]})}),(0,R.tZ)(D,{children:(0,v.t)("Set a failed status")}),(0,R.tZ)(H,{children:(0,v.t)("How long a check-in is allowed to run before it's considered failed. If the job encounters an error it will also fail.")}),(0,R.tZ)(K,{children:(0,R.BX)(J,{children:[(0,R.tZ)(M,{name:"config.max_runtime",placeholder:"e.g. 30",stacked:!0,inline:!1}),(0,R.tZ)(P,{children:(0,v.t)("Minutes")})]})})]})})}B.displayName="MonitorForm";const O=B,T=(0,o.Z)(Z.Z,{target:"epnopid13"})({name:"s5q70c",styles:"width:500px"}),F=(0,o.Z)(b.Z,{target:"epnopid12"})({name:"1hcx8jb",styles:"padding:0"}),M=(0,o.Z)(c.Z,{target:"epnopid11"})({name:"1hcx8jb",styles:"padding:0"}),z=(0,o.Z)(p.Z,{target:"epnopid10"})({name:"1hcx8jb",styles:"padding:0"}),X=(0,o.Z)(a.Z,{target:"epnopid9"})({name:"1hcx8jb",styles:"padding:0"}),L=(0,o.Z)(m.Z,{target:"epnopid8"})({name:"1hcx8jb",styles:"padding:0"}),V=(0,o.Z)(u.Z,{target:"epnopid7"})({name:"1hcx8jb",styles:"padding:0"}),D=(0,o.Z)(x.Z,{target:"epnopid6"})("font-size:",(e=>e.theme.fontSizeExtraLarge),";font-weight:bold;line-height:1.3;"),P=(0,o.Z)(y.Z,{target:"epnopid5"})("font-weight:bold;color:",(e=>e.theme.subText),";"),H=(0,o.Z)(P,{target:"epnopid4"})("font-weight:normal;padding-left:",(0,_.Z)(4),";"),K=(0,o.Z)("div",{target:"epnopid3"})("padding-left:",(0,_.Z)(4),";margin-top:",(0,_.Z)(1),";margin-bottom:",(0,_.Z)(4),";display:flex;flex-direction:column;gap:",(0,_.Z)(1),";"),J=(0,o.Z)("div",{target:"epnopid2"})("display:grid;grid-template-columns:1fr auto;align-items:center;gap:",(0,_.Z)(1),";"),U=(0,o.Z)(J,{target:"epnopid1"})("grid-template-columns:",(e=>e.interval&&"auto")," 1fr 2fr;"),G=(0,o.Z)(P,{target:"epnopid0"})("font-weight:normal;font-size:",(e=>e.theme.fontSizeExtraSmall),";font-family:",(e=>e.theme.text.familyMono),";grid-column:auto/span 2;")},"./app/views/monitors/types.tsx":(e,t,n)=>{let i,o,s,r;n.d(t,{Ix:()=>o,NI:()=>r,wo:()=>s}),function(e){e.UNKNOWN="unknown",e.CRON_JOB="cron_job"}(i||(i={})),function(e){e.CRONTAB="crontab",e.INTERVAL="interval"}(o||(o={})),function(e){e.OK="ok",e.ERROR="error",e.DISABLED="disabled",e.ACTIVE="active",e.MISSED_CHECKIN="missed_checkin"}(s||(s={})),function(e){e.OK="ok",e.ERROR="error",e.IN_PROGRESS="in_progress",e.MISSED="missed"}(r||(r={}))},"./app/views/monitors/utils.tsx":(e,t,n)=>{n.d(t,{Z:()=>r});var i=n("../node_modules/cronstrue/dist/cronstrue.js"),o=n.n(i),s=n("./app/utils/dates.tsx");function r(e){if(!e)return null;let t;try{t=o().toString(e,{verbose:!0,use24HourTimeFormat:(0,s.gn)()})}catch(e){return null}return t}}}]);
//# sourceMappingURL=../sourcemaps/app_views_monitors_components_monitorForm_tsx.ad5e6b37b8dbd3082d4252c3e2ff52d6.js.map